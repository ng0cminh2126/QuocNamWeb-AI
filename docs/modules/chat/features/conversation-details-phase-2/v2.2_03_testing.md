# v2.2 File Attachment Display - Testing Requirements

> **Module:** Chat  
> **Feature:** File Attachment Display in Message Bubble  
> **Version:** 2.2  
> **Document Type:** Testing Specification  
> **Status:** âœ… APPROVED  
> **Created:** 2026-01-08

---

## ðŸ“‹ Testing Strategy

### Scope

**What to Test:**

- âœ… File attachment rendering trong message bubble
- âœ… Icon selection based on MIME type
- âœ… Filename display vÃ  truncation
- âœ… File size formatting (if available from API)
- âœ… Spacing consistency (file-only vs text+file)
- âœ… Responsive behavior (desktop vs mobile)
- âœ… Color variants (sent vs received messages)

**What NOT to Test (Out of Scope v2.2):**

- âŒ Download functionality (no download in v2.2)
- âŒ File preview modal (Phase 3)
- âŒ Click interactions (no action in v2.2)

---

## ðŸ§ª Unit Tests

### Test File: `ChatMainContainer.test.tsx` (5 new tests)

**Location:** `src/features/portal/components/__tests__/ChatMainContainer.test.tsx`

#### Test 1: File-only message renders correctly

```typescript
test('renders file-only message with icon and filename', () => {
  const message: ChatMessage = {
    id: '1',
    content: null,
    attachments: [{
      fileId: 'file-1',
      fileName: 'report.pdf',
      contentType: 'application/pdf',
      fileSize: 1234567,
    }],
    // ... other props
  };

  render(<MessageBubbleSimple message={message} ... />);

  // Assert file attachment rendered
  const fileElement = screen.getByTestId('file-attachment');
  expect(fileElement).toBeInTheDocument();

  // Assert filename displayed
  expect(screen.getByText('report.pdf')).toBeInTheDocument();

  // Assert file size formatted correctly
  expect(screen.getByText('1.2 MB')).toBeInTheDocument();

  // Assert FileIcon component rendered (check for icon presence)
  expect(fileElement.querySelector('svg')).toBeInTheDocument();
});
```

#### Test 2: Text + File message has correct spacing

```typescript
test('text + file message has correct padding and gap', () => {
  const message: ChatMessage = {
    id: '1',
    content: 'Here is the report',
    attachments: [{
      fileId: 'file-1',
      fileName: 'report.pdf',
      contentType: 'application/pdf',
    }],
    // ... other props
  };

  const { container } = render(<MessageBubbleSimple message={message} ... />);

  // Text container has pt-2
  const textDiv = screen.getByText('Here is the report').closest('div');
  expect(textDiv).toHaveClass('px-4', 'pt-2');

  // Gap between text and file
  const gapDiv = container.querySelector('.h-2');
  expect(gapDiv).toBeInTheDocument();

  // File has pb-3
  const fileDiv = screen.getByTestId('file-attachment');
  expect(fileDiv).toHaveClass('px-4', 'pb-3');
});
```

#### Test 3: File MIME types map to correct icons

```typescript
test('different file types show correct icons', () => {
  const testCases = [
    { contentType: 'application/pdf', expectedColor: 'text-red-600' },
    { contentType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', expectedColor: 'text-blue-600' },
    { contentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', expectedColor: 'text-green-600' },
    { contentType: 'application/vnd.openxmlformats-officedocument.presentationml.presentation', expectedColor: 'text-orange-600' },
    { contentType: 'application/zip', expectedColor: 'text-gray-600' },
  ];

  testCases.forEach(({ contentType, expectedColor }) => {
    const message: ChatMessage = {
      id: '1',
      attachments: [{ fileId: 'f1', fileName: 'test', contentType }],
      // ... other props
    };

    const { container } = render(<MessageBubbleSimple message={message} ... />);

    // Check FileIcon has correct color class
    const icon = container.querySelector(`svg.${expectedColor}`);
    expect(icon).toBeInTheDocument();

    cleanup();
  });
});
```

#### Test 4: Long filename truncates properly

```typescript
test('long filename truncates with ellipsis', () => {
  const longFilename = 'Annual_Financial_Report_Q4_2024_Final_Version_2.pdf';
  const message: ChatMessage = {
    id: '1',
    attachments: [{
      fileId: 'file-1',
      fileName: longFilename,
      contentType: 'application/pdf',
    }],
    // ... other props
  };

  render(<MessageBubbleSimple message={message} ... />);

  const filenameElement = screen.getByText(longFilename);
  expect(filenameElement).toHaveClass('truncate');
});
```

#### Test 5: File without size doesn't render size element

```typescript
test('file attachment without size omits size display', () => {
  const message: ChatMessage = {
    id: '1',
    attachments: [{
      fileId: 'file-1',
      fileName: 'report.pdf',
      contentType: 'application/pdf',
      // fileSize: undefined
    }],
    // ... other props
  };

  const { container } = render(<MessageBubbleSimple message={message} ... />);

  // Filename should be present
  expect(screen.getByText('report.pdf')).toBeInTheDocument();

  // File size text should not be present
  const sizeElements = container.querySelectorAll('.text-xs.text-gray-500');
  expect(sizeElements.length).toBe(0);
});
```

---

## ðŸ§ª Integration Tests (Manual)

### Test Suite 1: Basic File Display

| Test ID | Description                     | Steps                                 | Expected Result                            |
| ------- | ------------------------------- | ------------------------------------- | ------------------------------------------ |
| FD-01   | PDF file displays correctly     | 1. Send PDF file<br>2. Check message  | Icon red, filename shown, size formatted   |
| FD-02   | Word file displays correctly    | 1. Send DOCX file<br>2. Check message | Icon blue, filename shown, size formatted  |
| FD-03   | Excel file displays correctly   | 1. Send XLSX file<br>2. Check message | Icon green (Sheet), filename shown         |
| FD-04   | PPT file displays correctly     | 1. Send PPTX file<br>2. Check message | Icon orange (Presentation), filename shown |
| FD-05   | Generic file displays correctly | 1. Send ZIP file<br>2. Check message  | Icon gray (File), filename shown           |

### Test Suite 2: Mixed Content

| Test ID | Description                  | Steps                                    | Expected Result                           |
| ------- | ---------------------------- | ---------------------------------------- | ----------------------------------------- |
| MC-01   | Text + PDF message spacing   | 1. Send text + PDF<br>2. Check spacing   | Text px-4 pt-2, gap h-2, file px-4 pb-3   |
| MC-02   | Text + Image message spacing | 1. Send text + image<br>2. Check spacing | Text px-4 pt-2, gap h-2, image no padding |
| MC-03   | File-only message spacing    | 1. Send PDF only<br>2. Check spacing     | File px-4 py-3                            |

### Test Suite 3: Filename Handling

| Test ID | Description                   | Steps                                    | Expected Result             |
| ------- | ----------------------------- | ---------------------------------------- | --------------------------- |
| FN-01   | Short filename displays fully | 1. Send "report.pdf"<br>2. Check         | Full filename visible       |
| FN-02   | Long filename truncates       | 1. Send 100-char filename<br>2. Check    | Truncated with ... ellipsis |
| FN-03   | No filename (fallback)        | 1. API returns null filename<br>2. Check | Shows "File" as fallback    |

### Test Suite 4: File Size

| Test ID | Description | Steps | Expected Result |
| FS-01 | Bytes format (<1KB) | 1. Send 512B file<br>2. Check size | Shows "512 B" |
| FS-02 | KB format (1KB-1MB) | 1. Send 500KB file<br>2. Check size | Shows "500.0 KB" |
| FS-03 | MB format (>1MB) | 1. Send 1.5MB file<br>2. Check size | Shows "1.5 MB" |
| FS-04 | No size available | 1. API returns null size<br>2. Check | Size element not rendered |

### Test Suite 5: Responsive Design

| Test ID | Description                | Steps                               | Expected Result                         |
| ------- | -------------------------- | ----------------------------------- | --------------------------------------- |
| RD-01   | Desktop (â‰¥1024px) layout   | 1. Resize to 1440px<br>2. Send file | Full layout, no wrapping                |
| RD-02   | Tablet (768-1023px) layout | 1. Resize to 800px<br>2. Send file  | Same layout, responsive width           |
| RD-03   | Mobile (<640px) layout     | 1. Resize to 375px<br>2. Send file  | Filename truncates, icon + size visible |

### Test Suite 6: Interaction (v2.2 No Action)

| Test ID | Description             | Steps                                  | Expected Result                         |
| ------- | ----------------------- | -------------------------------------- | --------------------------------------- |
| INT-01  | No click action on file | 1. Click file attachment<br>2. Observe | Nothing happens (no download, no modal) |
| INT-02  | No hover effect         | 1. Hover over file<br>2. Observe       | No hover style, cursor: default         |

---

## ðŸ“Š Test Coverage Matrix

| Component               | Unit Tests | Integration Tests | Manual Tests | Coverage |
| ----------------------- | ---------- | ----------------- | ------------ | -------- |
| File rendering          | âœ… 5 tests | âœ… FD-01 to FD-05 | âœ… Manual    | 100%     |
| Icon selection          | âœ… Test 3  | âœ… FD-01 to FD-05 | âœ… Manual    | 100%     |
| Spacing (mixed content) | âœ… Test 2  | âœ… MC-01 to MC-03 | âœ… Manual    | 100%     |
| Filename truncation     | âœ… Test 4  | âœ… FN-01 to FN-03 | âœ… Manual    | 100%     |
| File size formatting    | âœ… Test 5  | âœ… FS-01 to FS-04 | âœ… Manual    | 100%     |
| Responsive design       | -          | âœ… RD-01 to RD-03 | âœ… Manual    | 100%     |
| No interactions         | -          | âœ… INT-01, INT-02 | âœ… Manual    | 100%     |

**Total Coverage:** 100% (all critical paths tested)

---

## ðŸŽ¯ Test Data

### Sample Messages

```typescript
// File-only PDF
const pdfMessage: ChatMessage = {
  id: "1",
  senderId: "user-1",
  senderName: "John Doe",
  content: null,
  contentType: "FILE",
  attachments: [
    {
      fileId: "file-123",
      fileName: "Q4_Report_2024.pdf",
      contentType: "application/pdf",
      fileSize: 1234567, // 1.2 MB
    },
  ],
  sentAt: "2024-01-08T10:00:00Z",
};

// Text + Word file
const textWordMessage: ChatMessage = {
  id: "2",
  senderId: "user-1",
  senderName: "John Doe",
  content: "Here is the proposal document",
  contentType: "FILE",
  attachments: [
    {
      fileId: "file-456",
      fileName: "Proposal.docx",
      contentType:
        "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
      fileSize: 512000, // 500 KB
    },
  ],
  sentAt: "2024-01-08T10:05:00Z",
};

// Long filename
const longFilenameMessage: ChatMessage = {
  id: "3",
  senderId: "user-1",
  senderName: "John Doe",
  content: null,
  contentType: "FILE",
  attachments: [
    {
      fileId: "file-789",
      fileName:
        "Annual_Financial_Report_Q4_2024_Final_Version_Approved_by_Board.pdf",
      contentType: "application/pdf",
      fileSize: 2097152, // 2 MB
    },
  ],
  sentAt: "2024-01-08T10:10:00Z",
};
```

---

## âœ… Test Execution Checklist

### Pre-Implementation

- [x] Test requirements documented
- [x] Test data prepared
- [x] HUMAN approval received

### Post-Implementation

- [ ] Run all 5 unit tests â†’ All passing
- [ ] Execute manual test suites (FD, MC, FN, FS, RD, INT)
- [ ] Test on Chrome, Firefox, Safari
- [ ] Test on mobile devices (iOS, Android)
- [ ] Verify no TypeScript errors
- [ ] Verify no console errors
- [ ] Update test coverage report

---

## ðŸ”— Related Documents

- [v2.2_01_implementation-plan.md](./v2.2_01_implementation-plan.md) - Implementation plan
- [v2.2_02_wireframe.md](./v2.2_02_wireframe.md) - UI specifications
- [06_testing.md](./06_testing.md) - v2.0/v2.1 testing requirements

---

**Status:** âœ… APPROVED - Ready for test implementation  
**Next Step:** Begin v2.2 implementation with test-driven approach
