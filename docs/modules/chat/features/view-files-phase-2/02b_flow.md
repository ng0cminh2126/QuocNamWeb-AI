# [BÆ¯á»šC 2B] View Files Phase 2 - User Flow

**Module:** Chat  
**Feature:** View All Files - Jump to Message Logic  
**Phase:** Flow Diagrams  
**Created:** 2026-01-16  
**Status:** âœ… APPROVED

---

## ğŸš¨ CRITICAL: NO UI CHANGES

> âš ï¸ **Phase 2 KHÃ”NG thay Ä‘á»•i UI/UX hiá»‡n táº¡i**  
> âœ… **CHá»ˆ bá»• sung logic** cho button "Xem tin nháº¯n gá»‘c" Ä‘Ã£ cÃ³ sáºµn

---

## ğŸ”„ Flow 1: Jump to Message - Happy Path

**Goal:** User navigates from file preview back to message context

```
Step 1: User opens ViewAllFilesModal
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ViewAllFilesModal                          â”‚
â”‚                                            â”‚
â”‚ [Grid of images/files]                     â”‚
â”‚                                            â”‚
â”‚ User hovers over file â†’ [â‹®] menu appears  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 2: User clicks 3-dot menu
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Popover Menu                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚ ğŸ’¾ Táº£i xuá»‘ng           â”‚                 â”‚
â”‚ â”‚ ğŸ“‹ Sao chÃ©p link       â”‚                 â”‚
â”‚ â”‚ ğŸ’¬ Xem tin nháº¯n gá»‘c <-- Click            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 3: System checks if message exists in view
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const messageElement = document.querySelectorâ”‚
â”‚   `[data-testid="message-bubble-${id}"]`  â”‚
â”‚                                            â”‚
â”‚ IF messageElement exists:                  â”‚
â”‚   â”œâ”€ Close modal                           â”‚
â”‚   â”œâ”€ Scroll to message (smooth)            â”‚
â”‚   â”œâ”€ Add highlight ring                    â”‚
â”‚   â””â”€ Remove ring after 2s                  â”‚
â”‚                                            â”‚
â”‚ ELSE:                                      â”‚
â”‚   â””â”€ Show toast "Äang táº£i tin nháº¯n..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (Happy path: message found)
Step 4: Modal closes (fade-out 150ms)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ViewAllFilesModal                          â”‚
â”‚                                            â”‚
â”‚ Opacity: 1 â†’ 0                             â”‚
â”‚ Scale: 1 â†’ 0.95                            â”‚
â”‚ Duration: 150ms                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 5: ChatMain scrolls to message
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatMain Container                         â”‚
â”‚                                            â”‚
â”‚ messageElement.scrollIntoView({            â”‚
â”‚   behavior: 'smooth',                      â”‚
â”‚   block: 'center'                          â”‚
â”‚ })                                         â”‚
â”‚                                            â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚ â”ƒ Target message appears in CENTER     â”ƒ  â”‚
â”‚ â”ƒ [ğŸ“· image.jpg]                        â”ƒ  â”‚
â”‚ â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 6: Message highlighted (ring-2 ring-orange-400 bg-orange-50/80)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatMain Container                         â”‚
â”‚                                            â”‚
â”‚ messageElement.classList.add(              â”‚
â”‚   'ring-2',                                â”‚
â”‚   'ring-orange-400',                       â”‚
â”‚   'ring-offset-2',                         â”‚
â”‚   'bg-orange-50/80',                       â”‚
â”‚   'transition-all',                        â”‚
â”‚   'duration-300'                           â”‚
â”‚ )                                          â”‚
â”‚                                            â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚ â”ƒ ğŸŸ  Orange ring + background glow     â”ƒ  â”‚ <-- User sees this!
â”‚ â”ƒ [ğŸ“· image.jpg]                        â”ƒ  â”‚
â”‚ â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (After 2500ms)
Step 7: Highlight auto-removed with smooth transition
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatMain Container                         â”‚
â”‚                                            â”‚
â”‚ setTimeout(() => {                         â”‚
â”‚   messageElement.classList.remove(         â”‚
â”‚     'ring-2',                              â”‚
â”‚     'ring-orange-400',                     â”‚
â”‚     'ring-offset-2',                       â”‚
â”‚     'bg-orange-50/80',                     â”‚
â”‚     'transition-all',                      â”‚
â”‚     'duration-300'                         â”‚
â”‚   )                                        â”‚
â”‚ }, 2500)                                   â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ }, 2000)                                   â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ring removed, message back to normal  â”‚ â”‚
â”‚ â”‚ [ğŸ“· image.jpg]                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
âœ… User successfully navigated to message context
```

---

## ğŸ”„ Flow 2: Jump to Message - Message Not Loaded Yet (Auto-Load)

**Scenario:** User clicks jump but message not in current loaded pages

```
Step 1-2: Same as Flow 1 (user clicks "Xem tin nháº¯n gá»‘c")
        â”‚
        â–¼
Step 3: System checks message existence
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const messageElement = document.querySelectorâ”‚
â”‚   `[data-testid="message-bubble-${id}"]`  â”‚
â”‚                                            â”‚
â”‚ Result: null (message not in DOM)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 4: Close modal & show loading toast
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ onClose() // Modal closes immediately      â”‚
â”‚ toast.info('Äang táº£i tin nháº¯n cÅ© hÆ¡n...') â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â„¹ï¸ Äang táº£i tin nháº¯n cÅ© hÆ¡n...         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 5: Auto-load retry loop (MAX 5 times)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR i = 0 to MAX_RETRIES (5):              â”‚
â”‚                                            â”‚
â”‚  1. await fetchNextPage()                  â”‚
â”‚     (Load ~50 older messages via API)      â”‚
â”‚                                            â”‚
â”‚  2. await 300ms delay                      â”‚
â”‚     (Wait for DOM update)                  â”‚
â”‚                                            â”‚
â”‚  3. querySelector again                    â”‚
â”‚                                            â”‚
â”‚  IF found:                                 â”‚
â”‚    â”œâ”€ scrollAndHighlight(element)          â”‚
â”‚    â”œâ”€ toast.success('ÄÃ£ tÃ¬m tháº¥y!')        â”‚
â”‚    â””â”€ BREAK loop                           â”‚
â”‚                                            â”‚
â”‚  ELSE IF hasNextPage:                      â”‚
â”‚    â””â”€ CONTINUE to next retry               â”‚
â”‚                                            â”‚
â”‚  ELSE:                                     â”‚
â”‚    â””â”€ BREAK (no more pages)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (Branch 1: Success)
Step 6A: Message found after retry
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Found after retry #3 (example)          â”‚
â”‚                                            â”‚
â”‚ scrollAndHighlight(messageElement)         â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ï¿½ Message highlighted with orange     â”‚ â”‚
â”‚ â”‚    ring + background glow              â”‚ â”‚
â”‚ â”‚ [ğŸ“· old-image.jpg]                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚ toast.success('ÄÃ£ tÃ¬m tháº¥y tin nháº¯n!')    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (Branch 2: Failure)
Step 6B: Message still not found
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ After 5 retries Ã— ~50 msgs each         â”‚
â”‚ = Loaded ~250 messages, still not found    â”‚
â”‚                                            â”‚
â”‚ toast.error(                               â”‚
â”‚   'KhÃ´ng tÃ¬m tháº¥y tin nháº¯n                 â”‚
â”‚   (cÃ³ thá»ƒ Ä‘Ã£ bá»‹ xÃ³a)'                      â”‚
â”‚ )                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flow 3: Jump to Message - Message Deleted

**Scenario:** Message was deleted after user opened modal

```
Step 1-2: Same as Flow 1
        â”‚
        â–¼
Step 3: System checks message existence
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ const messageElement = document.querySelectorâ”‚
â”‚   `[data-testid="message-bubble-${id}"]`  â”‚
â”‚                                            â”‚
â”‚ Result: null (message deleted)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 4: Show error toast
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ toast.error('Tin nháº¯n khÃ´ng tá»“n táº¡i')     â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âŒ Tin nháº¯n khÃ´ng tá»“n táº¡i              â”‚ â”‚ <-- Error toast
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚ Modal STAYS OPEN                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
âœ… User informed, can choose other actions
```

---

## ğŸ”„ Flow 4: Jump to Message - Different Conversation

**Scenario:** User viewing "All Starred Messages" from multiple conversations

```
Step 1: User in Conversation A, clicks starred file from Conversation B
        â”‚
        â–¼
Step 2: System detects different conversation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ if (message.conversationId !== currentId) {â”‚
â”‚   toast.info(                              â”‚
â”‚     'Tin nháº¯n nÃ y á»Ÿ cuá»™c trÃ² chuyá»‡n khÃ¡c'  â”‚
â”‚   )                                        â”‚
â”‚   return;                                  â”‚
â”‚ }                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Step 3: Toast shown
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â„¹ï¸ Tin nháº¯n nÃ y á»Ÿ cuá»™c trÃ² chuyá»‡n khÃ¡c â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                            â”‚
â”‚ Modal STAYS OPEN                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Future Enhancement (Phase 3):
- Navigate to target conversation first
- Then scroll to message

Current Phase 2:
âš ï¸ Just inform user, no cross-conversation jump
```

---

## ğŸ¯ State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ViewAllFilesModal States                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [Closed]
        â”‚
        â”‚ User clicks "Xem táº¥t cáº£"
        â–¼
    [Opening]
        â”‚ (150ms animation)
        â–¼
    [Open - Idle]
        â”‚
        â”œâ”€ User clicks [â‹®] menu
        â”‚       â”‚
        â”‚       â–¼
        â”‚   [Menu Open]
        â”‚       â”‚
        â”‚       â”œâ”€ User clicks "Táº£i xuá»‘ng" â†’ Download file
        â”‚       â”œâ”€ User clicks "Sao chÃ©p link" â†’ Copy link
        â”‚       â””â”€ User clicks "Xem tin nháº¯n gá»‘c"
        â”‚               â”‚
        â”‚               â–¼
        â”‚       [Jump to Message Process]
        â”‚               â”‚
        â”‚               â”œâ”€ Message found
        â”‚               â”‚       â”‚
        â”‚               â”‚       â–¼
        â”‚               â”‚   [Closing] â†’ Scroll & Highlight
        â”‚               â”‚
        â”‚               â””â”€ Message NOT found
        â”‚                       â”‚
        â”‚                       â–¼
        â”‚                   Show toast, stay [Open - Idle]
        â”‚
        â”œâ”€ User clicks X button â†’ [Closing]
        â”œâ”€ User presses ESC â†’ [Closing]
        â””â”€ User clicks backdrop â†’ [Closing]
                â”‚
                â–¼ (150ms animation)
            [Closed]
```

---

## ğŸ§ª Edge Cases Flow

### Edge Case 1: Multiple Rapid Clicks

```
User clicks "Xem tin nháº¯n gá»‘c" multiple times rapidly
        â”‚
        â–¼
System behavior:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ if (isJumping) return;  // Debounce        â”‚
â”‚                                            â”‚
â”‚ setIsJumping(true);                        â”‚
â”‚ await handleJump();                        â”‚
â”‚ setIsJumping(false);                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Only first click processed, others ignored
âœ… Prevents race conditions
```

### Edge Case 2: Modal Close During Scroll

```
User clicks jump â†’ Modal starts closing â†’ User presses ESC
        â”‚
        â–¼
System behavior:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modal close animation already in progress  â”‚
â”‚ ESC key ignored (modal already closing)    â”‚
â”‚ Scroll continues in background             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
âœ… No conflict, scroll completes normally
```

### Edge Case 3: Message Loads After Toast

```
User clicks jump â†’ Toast shows "Äang táº£i..." â†’ Message loads (realtime)
        â”‚
        â–¼
Current Phase 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toast shown, modal stays open              â”‚
â”‚ User must manually retry after load        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Future Phase 3:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Listen to message load event               â”‚
â”‚ Auto-retry jump when message appears       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ PENDING DECISIONS

| #   | Decision                       | Impact on Flow                     | HUMAN Decision           |
| --- | ------------------------------ | ---------------------------------- | ------------------------ |
| 1   | Modal close on jump            | Close immediately or after scroll? | âœ… **Close immediately** |
| 2   | Toast duration                 | 3s, 5s, or manual dismiss?         | âœ… **3s**                |
| 3   | Debounce time for rapid clicks | 300ms, 500ms, or 1000ms?           | âœ… **500ms**             |

---

## âœ… HUMAN CONFIRMATION

| Háº¡ng má»¥c                  | Status       |
| ------------------------- | ------------ |
| ÄÃ£ review user flows      | âœ… ÄÃ£ review |
| ÄÃ£ Ä‘iá»n Pending Decisions | âœ… ÄÃ£ Ä‘iá»n   |
| **APPROVED Ä‘á»ƒ thá»±c thi**  | âœ… APPROVED  |

**HUMAN Signature:** MINH ÄÃƒ DUYá»†T  
**Date:** 2026-01-16

---

**Next Step:** Create [04_implementation-plan.md](./04_implementation-plan.md) vá»›i detailed code changes
